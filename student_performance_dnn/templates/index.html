<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border: #dee2e6;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-container {
            width: 100%;
            max-width: 1400px;
            display: flex;
            gap: 30px;
            align-items: stretch;
            height: 85vh;
            min-height: 700px;
        }

        .input-section {
            flex: 1;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .form-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .form-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .form-header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .form-body {
            padding: 30px;
            flex: 1;
            overflow-y: auto;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        input, select {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 15px;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 6px;
            font-style: italic;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .btn i {
            margin-right: 10px;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
        }

        .result-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .prediction-panel {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .result-container {
            text-align: center;
            display: none;
        }

        .result-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-average {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
        }

        .result-needs-improvement {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-left: 5px solid #f44336;
        }

        .result-top {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-left: 5px solid #4caf50;
        }

        .result-good {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 5px solid #ff9800;
        }

        .result-error {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
            border-left: 5px solid #e91e63;
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .result-emoji {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .confidence-score {
            font-size: 1.1rem;
            color: var(--gray);
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
        }

        .probability-chart {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
            margin-bottom: 25px;
        }

        .probability-item {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }

        .probability-item:hover {
            transform: translateY(-3px);
        }

        .probability-label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .probability-value {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .below-avg { background: #ffebee; color: #c62828; }
        .average { background: #e3f2fd; color: #1565c0; }
        .good { background: #fff3e0; color: #ef6c00; }
        .excellent { background: #e8f5e8; color: #2e7d32; }

        .footer {
            text-align: center;
            margin-top: 25px;
            color: var(--gray);
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .placeholder-message {
            text-align: center;
            color: var(--gray);
            padding: 50px 30px;
        }

        .placeholder-message i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.5;
        }

        .placeholder-message h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .placeholder-message p {
            font-size: 1rem;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 968px) {
            .main-container {
                flex-direction: column;
                height: auto;
                min-height: auto;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .result-section {
                gap: 20px;
            }
            
            .prediction-panel {
                min-height: 400px;
            }

            .probability-chart {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .form-body {
                padding: 20px;
            }
            
            .prediction-panel {
                padding: 25px;
            }
            
            .form-header h1 {
                font-size: 1.5rem;
            }
            
            .result-emoji {
                font-size: 3rem;
            }
            
            .result-title {
                font-size: 1.3rem;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- LEFT SIDE: Input Form -->
        <div class="input-section">
            <div class="form-header">
                <h1><i class="fas fa-graduation-cap"></i> Student Performance Predictor</h1>
                <p>Enter your academic details for prediction</p>
            </div>
            
            <div class="form-body">
                <form method="POST" id="prediction-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="total_cgpa">Total CGPA</label>
                            <div class="input-with-icon">
                                <i class="fas fa-chart-line"></i>
                                <input type="number" step="0.01" min="0" max="10" id="total_cgpa" name="total_cgpa" placeholder="e.g., 8.45" required>
                            </div>
                            <div class="help-text">Cumulative Grade Point Average (0-10 scale)</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="prevsem_cgpa">Previous Semester CGPA</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar-alt"></i>
                                <input type="number" step="0.01" min="0" max="10" id="prevsem_cgpa" name="prevsem_cgpa" placeholder="e.g., 7.92" required>
                            </div>
                            <div class="help-text">CGPA from last completed semester</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="attendance">Attendance Percentage</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user-check"></i>
                                <input type="number" min="0" max="100" id="attendance" name="attendance" placeholder="e.g., 85" required>
                            </div>
                            <div class="help-text">Overall class attendance (0-100%)</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="study_hours">Weekly Study Hours</label>
                            <div class="input-with-icon">
                                <i class="fas fa-clock"></i>
                                <select id="study_hours" name="study_hours" required>
                                    <option value="">Select study hours range</option>
                                    <option value="0-10 (Minimal)">0-10 hours (Minimal)</option>
                                    <option value="11-20 (Moderate)">11-20 hours (Moderate)</option>
                                    <option value="21-30 (Regular)">21-30 hours (Regular)</option>
                                    <option value="31+ (Intensive)">31+ hours (Intensive)</option>
                                </select>
                            </div>
                            <div class="help-text">Average hours spent studying per week</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="backlogs">Number of Backlogs</label>
                            <div class="input-with-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                                <select id="backlogs" name="backlogs" required>
                                    <option value="">Select number of backlogs</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5+">5+</option>
                                </select>
                            </div>
                            <div class="help-text">Subjects requiring repetition or clearance</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="competitions">Competition Participation</label>
                            <div class="input-with-icon">
                                <i class="fas fa-trophy"></i>
                                <select id="competitions" name="competitions" required>
                                    <option value="">Select participation status</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                     <option value="More than 2">More than 2</option>
                                </select>
                            </div>
                            <div class="help-text">Participation in academic competitions</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="projects_internships">Projects/Internships</label>
                            <div class="input-with-icon">
                                <i class="fas fa-briefcase"></i>
                                <select id="projects_internships" name="projects_internships" required>
                                    <option value="">Select experience status</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                     <option value="More than 2">More than 2</option>
                                </select>
                            </div>
                            <div class="help-text">Completion of projects or internships</div>
                        </div>

                        <div class="form-group">
                            <label for="confidence_level">Study Confidence Level</label>
                            <div class="input-with-icon">
                                <i class="fas fa-brain"></i>
                                <select id="confidence_level" name="confidence_level" required>
                                    <option value="">Select confidence level</option>
                                    <option value="1">1 (Lowest)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Average)</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10 (Highest)</option>
                                </select>
                            </div>
                            <div class="help-text">Self-assessment of study confidence (1-10)</div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="btn" id="analyze-btn">
                            <i class="fas fa-chart-bar"></i> Analyze Performance
                        </button>
                        {% if prediction_text or error_text %}
                        <button type="button" class="btn btn-secondary" id="retry-btn">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                        {% endif %}
                    </div>
                </form>
                
                <div class="footer">
                    <p>¬© 2023 Student Performance Prediction System | Powered by Deep Neural Networks</p>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE: Prediction Results -->
        <div class="result-section">
            <div class="prediction-panel">
                {% if prediction_text %}
                <div class="result-container show 
                    {% if 'Below Average' in prediction_text %}result-needs-improvement
                    {% elif 'Average' in prediction_text %}result-average
                    {% elif 'Good' in prediction_text %}result-good
                    {% elif 'Excellent' in prediction_text %}result-top
                    {% endif %}">
                    <div class="result-emoji">
                        {% if 'Below Average' in prediction_text %}üòü
                        {% elif 'Average' in prediction_text %}üôÇ
                        {% elif 'Good' in prediction_text %}üòÉ
                        {% elif 'Excellent' in prediction_text %}üöÄ
                        {% endif %}
                    </div>
                    <div class="result-title">{{ prediction_text }}</div>
                    
                    {% if confidence_score %}
                    <div class="confidence-score">
                        <i class="fas fa-shield-alt"></i> Confidence: <strong>{{ "%.1f"|format(confidence_score) }}%</strong>
                    </div>
                    {% endif %}
                    
                    {% if probabilities %}
                    <div class="probability-chart">
                        <div class="probability-item below-avg">
                            <div class="probability-label">Below Average</div>
                            <div class="probability-value">{{ "%.1f"|format(probabilities['Below Average']) }}%</div>
                        </div>
                        <div class="probability-item average">
                            <div class="probability-label">Average</div>
                            <div class="probability-value">{{ "%.1f"|format(probabilities['Average']) }}%</div>
                        </div>
                        <div class="probability-item good">
                            <div class="probability-label">Good</div>
                            <div class="probability-value">{{ "%.1f"|format(probabilities['Good']) }}%</div>
                        </div>
                        <div class="probability-item excellent">
                            <div class="probability-label">Excellent</div>
                            <div class="probability-value">{{ "%.1f"|format(probabilities['Excellent']) }}%</div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- SUGGESTIONS BOX MOVED INSIDE THE PREDICTION PANEL -->
                    <div style="text-align: center; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px;">
                        <button onclick="startSuggestionChat()" 
                                style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
                                       color: white; 
                                       border: none; 
                                       padding: 15px 30px; 
                                       border-radius: 25px; 
                                       cursor: pointer;
                                       font-size: 16px;
                                       font-weight: bold;
                                       box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                                       transition: all 0.3s ease;">
                            üí¨ Get Interactive Suggestions
                        </button>
                        <p style="margin-top: 10px; color: #6c757d; font-size: 14px;">
                            Chat with our AI advisor for personalized academic guidance
                        </p>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" id="retry-btn-2">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                </div>
                {% elif error_text %}
                <div class="result-container show result-error">
                    <div class="result-emoji">‚ö†Ô∏è</div>
                    <div class="result-title">{{ error_text }}</div>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        Please check that all fields are filled correctly and try again.
                    </p>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" id="retry-btn-3">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                </div>
                {% else %}
                <div class="placeholder-message">
                    <i class="fas fa-chart-line"></i>
                    <h3>Awaiting Analysis</h3>
                    <p>Fill out the form on the left and click "Analyze Performance" to see your prediction results here.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

<!-- Chat Modal -->
<div id="chatModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                          width: 90%; max-width: 500px; background: white; border-radius: 15px; 
                          box-shadow: 0 20px 50px rgba(0,0,0,0.3); z-index: 1000; max-height: 80vh;">
    <!-- Chat Header -->
    <div style="background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%); color: white; padding: 20px; 
                border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0; font-size: 1.2rem;">üéì Academic Advisor</h3>
        <button onclick="closeChat()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px;">√ó</button>
    </div>
    
    <!-- Chat Messages -->
    <div id="chatMessages" style="height: 300px; overflow-y: auto; padding: 20px; background: #f8f9fa; 
                                 border-bottom: 1px solid #dee2e6;"></div>
    
    <!-- Chat Input -->
    <div style="padding: 20px; background: white; border-radius: 0 0 15px 15px;">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" id="chatInput" placeholder="Type your message..." 
                   style="flex: 1; padding: 12px; border: 2px solid #e9ecef; border-radius: 25px; 
                          outline: none; font-family: 'Poppins', sans-serif;"
                   onkeypress="if(event.key === 'Enter') sendChatMessage()">
            <button onclick="sendChatMessage()" 
                    style="background: #4361ee; color: white; border: none; padding: 12px 20px; 
                           border-radius: 25px; cursor: pointer; font-family: 'Poppins', sans-serif;">
                Send
            </button>
        </div>
        <button onclick="resetChat()" 
                style="background: #6c757d; color: white; border: none; padding: 8px 15px; 
                       border-radius: 15px; cursor: pointer; font-size: 12px; font-family: 'Poppins', sans-serif;">
            Reset Chat
        </button>
    </div>
</div>

<!-- Overlay -->
<div id="chatOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                            background: rgba(0,0,0,0.5); z-index: 999;"></div>


    <script>
        // Real-time validation
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                const value = parseFloat(this.value);
                const min = parseFloat(this.min);
                const max = parseFloat(this.max);
                
                if (value < min || value > max || isNaN(value)) {
                    this.style.borderColor = '#f44336';
                    this.style.boxShadow = '0 0 0 3px rgba(244, 67, 54, 0.1)';
                } else {
                    this.style.borderColor = '#4caf50';
                    this.style.boxShadow = '0 0 0 3px rgba(76, 175, 80, 0.1)';
                }
            });
        });

        // Form submission enhancement
        document.querySelector('form').addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing Performance...';
            submitBtn.disabled = true;
            
            // Re-enable button after 5 seconds in case of error
            setTimeout(() => {
                submitBtn.innerHTML = '<i class="fas fa-chart-bar"></i> Analyze Performance';
                submitBtn.disabled = false;
            }, 5000);
        });

        // Add input animations
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateY(-2px)';
            });
            
            element.addEventListener('blur', function() {
                this.parentElement.style.transform = 'translateY(0)';
            });
        });

        // Retry button functionality
        document.querySelectorAll('#retry-btn, #retry-btn-2, #retry-btn-3').forEach(button => {
            button.addEventListener('click', function() {
                // Reset form
                document.getElementById('prediction-form').reset();
                
                // Reset input borders
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.style.borderColor = '#e9ecef';
                    input.style.boxShadow = 'none';
                });
                
                // Reload the page to clear results
                window.location.href = '/';
            });
        });
    </script>
    <script>
let currentSessionId = 'session_' + Math.random().toString(36).substr(2, 9);

function startSuggestionChat() {
    document.getElementById('chatModal').style.display = 'block';
    document.getElementById('chatOverlay').style.display = 'block';
    document.getElementById('chatMessages').innerHTML = '';
    
    // Start conversation
    fetch('/start_chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({session_id: currentSessionId})
    })
    .then(response => response.json())
    .then(data => {
        addChatMessage(data.response, 'advisor');
        // ALWAYS show options after first message
        setTimeout(addQuickActions, 100);
    });
}

function closeChat() {
    document.getElementById('chatModal').style.display = 'none';
    document.getElementById('chatOverlay').style.display = 'none';
}

function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Check if user wants to end chat
    if (message.toLowerCase() === 'bye' || message.toLowerCase() === 'goodbye' || message.toLowerCase() === 'exit') {
        addChatMessage('You: ' + message, 'user');
        input.value = '';
        addChatMessage('Goodbye! Feel free to come back anytime for academic advice. Good luck with your studies! üéì', 'advisor');
        setTimeout(() => {
            closeChat();
        }, 2000);
        return;
    }
    
    // Add user message
    addChatMessage('You: ' + message, 'user');
    input.value = '';
    
    // Send to server
    fetch('/send_message', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            session_id: currentSessionId,
            message: message
        })
    })
    .then(response => response.json())
    .then(data => {
        addChatMessage(data.response, 'advisor');
        
        // ALWAYS show options after every advisor response
        setTimeout(addQuickActions, 100);
    });
}

function resetChat() {
    fetch('/reset_chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({session_id: currentSessionId})
    })
    .then(() => {
        document.getElementById('chatMessages').innerHTML = '';
        startSuggestionChat();
    });
}

function addChatMessage(text, sender) {
    const messagesDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    
    messageDiv.style.margin = '10px 0';
    messageDiv.style.padding = '12px 16px';
    messageDiv.style.borderRadius = '18px';
    messageDiv.style.maxWidth = '85%';
    messageDiv.style.wordWrap = 'break-word';
    messageDiv.style.fontSize = '14px';
    messageDiv.style.lineHeight = '1.4';
    
    if (sender === 'user') {
        messageDiv.style.background = '#4361ee';
        messageDiv.style.color = 'white';
        messageDiv.style.marginLeft = 'auto';
        messageDiv.style.borderBottomRightRadius = '5px';
    } else {
        messageDiv.style.background = 'white';
        messageDiv.style.color = '#333';
        messageDiv.style.border = '1px solid #dee2e6';
        messageDiv.style.marginRight = 'auto';
        messageDiv.style.borderBottomLeftRadius = '5px';
    }
    
    // Format text with line breaks and basic formatting
    let formattedText = text
        .replace(/\n/g, '<br>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>');
    
    messageDiv.innerHTML = formattedText;
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Quick action buttons (WITH BYE OPTION)
function addQuickActions() {
    const messagesDiv = document.getElementById('chatMessages');
    
    // Remove existing quick actions if any
    const existingActions = messagesDiv.querySelector('.quick-actions');
    if (existingActions) {
        existingActions.remove();
    }
    
    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'quick-actions';
    actionsDiv.style.margin = '15px 0';
    actionsDiv.style.textAlign = 'center';
    actionsDiv.style.padding = '15px';
    actionsDiv.style.background = '#f8f9fa';
    actionsDiv.style.borderRadius = '10px';
    actionsDiv.style.border = '1px solid #e9ecef';
    
    const title = document.createElement('div');
    title.textContent = 'üí° Quick Help Options - Click Any:';
    title.style.fontWeight = 'bold';
    title.style.marginBottom = '10px';
    title.style.color = '#4361ee';
    actionsDiv.appendChild(title);
    
    const quickTopics = [
        {'text': 'üìã Get My Summary', 'query': 'summary'},
        {'text': 'üìä Academic Analysis', 'query': 'academic performance analysis'},
        {'text': 'üéØ Study Techniques', 'query': 'study techniques time management'},
        {'text': 'üìñ Exam Preparation', 'query': 'exam preparation strategies'},
        {'text': 'üíº Career Guidance', 'query': 'career guidance placements'},
        {'text': 'üòå Mental Health', 'query': 'mental health motivation'},
        {'text': 'üåø Campus Life', 'query': 'campus life balance'},
        {'text': 'üëã End Chat', 'query': 'bye', 'isBye': true}
    ];
    
    const buttonsContainer = document.createElement('div');
    buttonsContainer.style.display = 'flex';
    buttonsContainer.style.flexWrap = 'wrap';
    buttonsContainer.style.justifyContent = 'center';
    buttonsContainer.style.gap = '8px';
    
    quickTopics.forEach(topic => {
        const btn = document.createElement('button');
        btn.textContent = topic.text;
        btn.style.background = 'white';
        btn.style.border = '2px solid #4361ee';
        btn.style.borderRadius = '20px';
        btn.style.padding = '10px 15px';
        btn.style.fontSize = '12px';
        btn.style.cursor = 'pointer';
        btn.style.transition = 'all 0.3s ease';
        btn.style.fontWeight = '500';
        btn.style.color = '#4361ee';
        btn.style.flex = '1';
        btn.style.minWidth = '140px';
        btn.style.maxWidth = '180px';
        
        // Highlight the Summary option
        if (topic.text.includes('Summary')) {
            btn.style.background = '#4361ee';
            btn.style.color = 'white';
            btn.style.border = '2px solid #3a56d4';
            btn.style.fontWeight = '600';
        }
        
        // Style the Bye option differently
        if (topic.isBye) {
            btn.style.background = '#6c757d';
            btn.style.color = 'white';
            btn.style.border = '2px solid #495057';
            btn.style.fontWeight = '600';
        }
        
        btn.onmouseover = () => {
            if (topic.isBye) {
                btn.style.background = '#495057';
                btn.style.color = 'white';
            } else {
                btn.style.background = '#4361ee';
                btn.style.color = 'white';
            }
            btn.style.transform = 'translateY(-2px)';
            btn.style.boxShadow = '0 4px 8px rgba(67, 97, 238, 0.3)';
        };
        btn.onmouseout = () => {
            if (topic.text.includes('Summary')) {
                btn.style.background = '#4361ee';
                btn.style.color = 'white';
            } else if (topic.isBye) {
                btn.style.background = '#6c757d';
                btn.style.color = 'white';
            } else {
                btn.style.background = 'white';
                btn.style.color = '#4361ee';
            }
            btn.style.transform = 'translateY(0)';
            btn.style.boxShadow = 'none';
        };
        
        btn.onclick = () => {
            if (topic.isBye) {
                // Handle bye click - auto send and close chat
                document.getElementById('chatInput').value = 'bye';
                sendChatMessage();
            } else {
                // Auto-fill and send the message for other options
                document.getElementById('chatInput').value = topic.query;
                sendChatMessage();
            }
        };
        
        buttonsContainer.appendChild(btn);
    });
    
    actionsDiv.appendChild(buttonsContainer);
    
    // Add note about options
    const note = document.createElement('div');
    note.textContent = 'üìã Summary shows your academic profile with personalized insights ‚Ä¢ üëã Click "End Chat" to close';
    note.style.marginTop = '10px';
    note.style.fontSize = '11px';
    note.style.color = '#6c757d';
    note.style.fontStyle = 'italic';
    note.style.textAlign = 'center';
    actionsDiv.appendChild(note);
    
    messagesDiv.appendChild(actionsDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Close modal when clicking overlay
document.getElementById('chatOverlay').addEventListener('click', closeChat);

// Handle Enter key in chat input
document.getElementById('chatInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendChatMessage();
});
</script>
    
</body>
</html>